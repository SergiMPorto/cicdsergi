version: 2.1

executors:
  java_executor:
    docker:
      - image: cimg/openjdk:21.0
    working_directory: ~/project

jobs:
  build:
    executor: java_executor
    steps:
      - checkout
      - run:
          name: Ver versiÃ³n de Java
          command: java -version
      - run:
          name: Compilar clases Java
          command: javac -d target/classes NumeroPrimoAPP/src/main/java/Laboratorio/*.java
      - ***REMOVED***:
          root: target
          paths:
            - classes

  show_files:
    executor: java_executor
    steps:
      - checkout
      - run:
          name: Mostrar archivos fuente
          command: ls -R NumeroPrimoAPP/src/main/java/Laboratorio

  test:
    executor: java_executor
    steps:
      - checkout
      - attach_workspace:
          at: target
      - run:
          name: Download JUnit 5
          command: |
            mkdir -p libs
            curl -L -o libs/junit.jar https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.10.0/junit-platform-console-standalone-1.10.0.jar
      - run:
          name: Compilar test
          command: |
            find NumeroPrimoAPP/src/test/java -name "*.java" > test_sources.txt
            javac -cp "libs/junit.jar:target/classes" -d target/test-classes @test_sources.txt
      - run:
          name: Ejecutar test
          command: java -jar libs/junit.jar --class-path target/classes:target/test-classes --scan-class-path

  testandlint:
    executor: java_executor
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: mvn clean install
      - run:
          name: Run tests
          command: mvn test
      - run:
          name: Run Checkstyle
          command: mvn checkstyle:check

workflows:
  testing_workflow:
    jobs:
      - build
      - show_files
      - test:
          requires:
            - build
      - testandlint:
          requires:
            - build
