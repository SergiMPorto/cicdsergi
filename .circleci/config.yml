version: 2.1

executors:
  java_executor:
    docker:
      - image: cimg/openjdk:21.0  # mejor que circleci/openjdk (deprecated)
    working_directory: ~/project

jobs:
  build:
    executor: java_executor
    steps:
      - checkout
      - run:
          name: Ver versi√≥n de Java
          command: java -version
      - run:
          name: Compilar clases Java
          command: javac -d target/classes NumeroPrimoAPP/src/main/java/Laboratorio/*.java
      - ***REMOVED***:
          root: target
          paths:
            - classes

  show_files:
    executor: java_executor
    steps:
      - checkout
      - run:
          name: Mostrar archivos fuente
          command: ls -R NumeroPrimoAPP/src/main/java/Laboratorio

  test:
    executor: java_executor
    steps:
      - checkout
      - attach_workspace:
          at: target
      - run:
          name: Descargar JUnit 5
          command: |
            mkdir -p libs
            curl -L -o libs/junit.jar https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.10.0/junit-platform-console-standalone-1.10.0.jar
      - run:
          name: Compilar test
          command: javac -cp "libs/junit.jar:target/classes" -d target/test-classes NumeroPrimoAPP/src/test/java/Laboratorio/*.java
      - run:
          name: Ejecutar test
          command: java -jar libs/junit.jar --class-path target/classes:target/test-classes --scan-class-path
          
workflows:
  my_workflow:
    jobs:
      - build
      - show_files
      - test:
          requires:
            - build
